jQuery(document).ready(function(t){function e(e){e=this;var n=[];return t(".enp-btn",this).each(function(){var e=t(this).attr("data-btn-slug"),a=t(this).attr("data-btn-type"),r=u(a,e);if("object"==typeof r&&null!==r){var s=t(this).attr("data-pid"),i=t.inArray(s,r);if(-1!==i){t(this).attr("data-operator","-"),t(this).addClass("enp-btn--user-clicked"),t(this).removeClass("enp-btn--user-has-not-clicked"),t(this).find("use").attr("xlink:href","#enp-btn--user-clicked");var p=t(".enp-btn__name",this).text();n.push(p)}}}),n}function n(e,n){var r=a(e);0===r&&t(".enp-btn__count",e).removeClass("enp-btn__count--zero"),"+"===n?new_count=r+1:new_count=r-1,t(e).attr("data-count",new_count),new_count=h(new_count),new_count="<span>"+new_count+"</span>",t(".enp-btn__count",e).html(new_count)}function a(e){return curr_count=t(e).attr("data-count"),parseInt(curr_count)}function r(e){var n=a(e),r=n-1;t(e).attr("data-count",r),r=h(r),t(".enp-btn__count",e).html(r)}function s(t,e){t.append('<p class="enp-btn-error-message">'+e+"</p>")}function p(t,e,n){r(t),s(e,n),t.addClass("enp-btn--disabled enp-btn--error")}function o(e){var n=enp_button_params.enp_login_url;t(".enp-btn-error-message").length&&t(".enp-btn-error-message").remove();var a=t(e).parent().parent().parent().attr("id");n=n+"%2F%23"+a;var r=t(e).parent().parent(),i='You must be <a href="'+n+'">logged in</a> to click this button. Please <a href="'+n+'">log in</a> and try again.';s(r,i)}function c(e,n,a,r){var s=u(e,n);if("object"==typeof s&&null!==s){var i=t.inArray(a,s);"-"===r&&-1!==i?s.splice(i,1):"+"===r&&-1===i?s.push(a):console.log("Something is not right. The operator is "+r+", and the index is "+i+".")}else s=[a];localStorage.setItem("enp_button_"+e+"_"+n,JSON.stringify(s))}function u(t,e){var n=localStorage.getItem("enp_button_"+t+"_"+e);return n=JSON.parse(n)}function l(e,n){var a="",r="";if(e.length){a='<p class="enp-btn-hint enp-user-clicked-hint">';var s=["Important","Thoughtful","Useful"],i=t.grep(s,function(n){return-1!==t.inArray(n,e)});i.length&&(r="This "+n+" is "+d(i)+" to you.",e=e.filter(function(t){return-1==i.indexOf(t)})),e.length&&(a+="You ",a+=d(e),a=a+" this "+n+"."),a&&r&&(r=" "+r),a=a+r+"</p>"}return a}function d(t){var e,n=t.length,a="";for(i=0;i<t.length;i++)e=i+1,e===n?n>2?a=a+"and "+t[i]:n>1?a=a+"and "+t[i]:a+=t[i]:a=1===e?n>2?a+t[i]+", ":a+t[i]+" ":a+t[i]+", ";return a}function h(t){var e,n;if(t>=1e3){var a,r;t>=1e6?(a="m",r=1e5):(a="k",r=1e3),e=t/r,e=Math.floor(10*e)/10,e=_(e),n=e+'<span class="enp-btn-count-formatter">'+a+"</span>"}else e=t,n=t;return n}function _(t){for(;/(\d+)(\d{3})/.test(t.toString());)t=t.toString().replace(/(\d+)(\d{3})/,"$1,$2");return t}t(".enp-btns-wrap").removeClass("enp-btns-wrap--disabled");var b=enp_button_params.enp_btn_user_id,f=enp_button_params.enp_btn_clickable;0===parseInt(b)&&0!==parseInt(f)&&t(".enp-btns-wrap").each(function(){var n=(t(this),e.call(this));if(n.length){var a=t(this).attr("data-btn-type"),r=l(n,a);t(".enp-user-clicked-hint",this).length?t(".enp-user-clicked-hint",this).replaceWith(r):t(".enp-btns",this).after(r)}}),t(".enp-btn").click(function(a){a.preventDefault();var r=enp_button_params.enp_btn_clickable;if(t(this).hasClass("enp-btn--error")||t(this).hasClass("enp-btn--disabled")||t(this).hasClass("enp-btn--click-wait"))return!1;if(0===parseInt(r))return o(this),!1;t(this).addClass("enp-btn--click-wait");var s=t(this).attr("data-pid"),i=t(this).attr("data-nonce"),u=t(this).attr("data-btn-slug"),d=t(this).attr("data-btn-type"),h=t(this).attr("data-operator"),_=enp_button_params.ajax_url,b=enp_button_params.enp_btn_user_id;n(this,h),t.ajax({type:"POST",url:_,data:{action:"enp_update_button_count",pid:s,slug:u,type:d,operator:h,user_id:b,nonce:i},dataType:"xml",success:function(n){var a,r=t(n).find("type").text(),s=t(n).find("pid").text(),i=t(n).find("slug").text(),o=t("#"+i+"_"+r+"_"+s),u=t(n).find("response_data").text(),d=t(".enp-btns-"+r+"-"+s),h=t("#enp-btns-wrap-"+r+"-"+s),_=t(n).find("new_operator").text();if(a="+"===_?"-":"+","error"===u){var b=t(n).find("message").text();p(o,d,b)}else{o.attr("data-operator",_),"-"===_?(o.removeClass("enp-btn--decreased"),o.addClass("enp-btn--increased"),o.removeClass("enp-btn--user-has-not-clicked"),o.addClass("enp-btn--user-clicked"),o.find("use").attr("xlink:href","#enp-btn--user-clicked")):(o.removeClass("enp-btn--increased"),o.addClass("enp-btn--decreased"),o.addClass("enp-btn--user-has-not-clicked"),o.removeClass("enp-btn--user-clicked"),o.find("use").attr("xlink:href","#enp-btn--user-has-not-clicked"));var f,g=enp_button_params.enp_btn_user_id;if(0===parseInt(g)){c(r,i,s,a),f="";var v=e.call(h);v.length&&(f=l(v,r),t(".enp-user-clicked-hint",this).length?t(".enp-user-clicked-hint",this).replaceWith(f):t(".enp-btns",this).after(f))}else f=t(n).find("user_clicked_message").text();t(".enp-user-clicked-hint",h).length?t(".enp-user-clicked-hint",h).replaceWith(f):d.after(f),t.ajax({type:"POST",url:enp_button_params.ajax_url,data:{action:"enp_send_button_count",pid:s,slug:i,type:r},dataType:"xml",success:function(t){},error:function(t){}})}o.removeClass("enp-btn--click-wait")},error:function(e){var n=t.parseJSON(e.responseText),a=n.message,r=n.pid,s=n.btn_type,i=n.btn_slug,o=t("#"+i+"_"+s+"_"+r),c=t(".enp-btns-"+s+"-"+r);p(o,c,a),o.removeClass("enp-btn--click-wait")}})})});